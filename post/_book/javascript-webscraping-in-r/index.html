<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Javascript webscraping in R | Brooke Watson: Scraping Javascript websites in R</title>
  <meta name="description" content="2 Javascript webscraping in R | Brooke Watson: Scraping Javascript websites in R" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Javascript webscraping in R | Brooke Watson: Scraping Javascript websites in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Javascript webscraping in R | Brooke Watson: Scraping Javascript websites in R" />
  
  
  

<meta name="author" content="Brooke Watson" />


<meta name="date" content="2018-03-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="background-remixing-packages-in-r.html">
<link rel="next" href="organizing-an-r-package.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; }  
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; }  
code span.at { color: #7d9029; }  
code span.bn { color: #40a070; }  
code span.bu { }  
code span.cf { color: #007020; font-weight: bold; }  
code span.ch { color: #4070a0; }  
code span.cn { color: #880000; }  
code span.co { color: #60a0b0; font-style: italic; }  
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; }  
code span.do { color: #ba2121; font-style: italic; }  
code span.dt { color: #902000; }  
code span.dv { color: #40a070; }  
code span.er { color: #ff0000; font-weight: bold; }  
code span.ex { }  
code span.fl { color: #40a070; }  
code span.fu { color: #06287e; }  
code span.im { }  
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; }  
code span.kw { color: #007020; font-weight: bold; }  
code span.op { color: #666666; }  
code span.ot { color: #007020; }  
code span.pp { color: #bc7a00; }  
code span.sc { color: #4070a0; }  
code span.ss { color: #bb6688; }  
code span.st { color: #4070a0; }  
code span.va { color: #19177c; }  
code span.vs { color: #4070a0; }  
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; }  
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="background-remixing-packages-in-r.html"><a href="background-remixing-packages-in-r.html"><i class="fa fa-check"></i><b>1</b> Background: remixing packages in R</a></li>
<li class="chapter" data-level="2" data-path="javascript-webscraping-in-r.html"><a href="javascript-webscraping-in-r.html"><i class="fa fa-check"></i><b>2</b> Javascript webscraping in R</a><ul>
<li class="chapter" data-level="2.1" data-path="javascript-webscraping-in-r.html"><a href="javascript-webscraping-in-r.html#download-phantomjs-using-homebrew"><i class="fa fa-check"></i><b>2.1</b> Download PhantomJS using homebrew</a></li>
<li class="chapter" data-level="2.2" data-path="javascript-webscraping-in-r.html"><a href="javascript-webscraping-in-r.html#writing-scrape.js"><i class="fa fa-check"></i><b>2.2</b> Writing scrape.js</a></li>
<li class="chapter" data-level="2.3" data-path="javascript-webscraping-in-r.html"><a href="javascript-webscraping-in-r.html#scraping-therapboard.com"><i class="fa fa-check"></i><b>2.3</b> Scraping TheRapBoard.com</a></li>
<li class="chapter" data-level="2.4" data-path="javascript-webscraping-in-r.html"><a href="javascript-webscraping-in-r.html#extracting-audio-files"><i class="fa fa-check"></i><b>2.4</b> Extracting audio files</a></li>
<li class="chapter" data-level="2.5" data-path="javascript-webscraping-in-r.html"><a href="javascript-webscraping-in-r.html#downloading-mp3s"><i class="fa fa-check"></i><b>2.5</b> Downloading mp3s</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="organizing-an-r-package.html"><a href="organizing-an-r-package.html"><i class="fa fa-check"></i><b>3</b> Organizing an R package</a><ul>
<li class="chapter" data-level="3.1" data-path="organizing-an-r-package.html"><a href="organizing-an-r-package.html#converting-mp3s-to-wavs"><i class="fa fa-check"></i><b>3.1</b> Converting mp3s to wavs</a></li>
<li class="chapter" data-level="3.2" data-path="organizing-an-r-package.html"><a href="organizing-an-r-package.html#cleaning-up-and-filtering-.wav-file-names"><i class="fa fa-check"></i><b>3.2</b> Cleaning up and filtering .wav file names</a></li>
<li class="chapter" data-level="3.3" data-path="organizing-an-r-package.html"><a href="organizing-an-r-package.html#tidying-file-names"><i class="fa fa-check"></i><b>3.3</b> Tidying file names</a></li>
<li class="chapter" data-level="3.4" data-path="organizing-an-r-package.html"><a href="organizing-an-r-package.html#renaming-file-paths-from-within-r"><i class="fa fa-check"></i><b>3.4</b> Renaming file paths from within R</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="remixing-the-beep-function.html"><a href="remixing-the-beep-function.html"><i class="fa fa-check"></i><b>4</b> Remixing the beep() function</a></li>
<li class="chapter" data-level="5" data-path="wrapping-it-all-into-a-package.html"><a href="wrapping-it-all-into-a-package.html"><i class="fa fa-check"></i><b>5</b> Wrapping it all into a package</a></li>
<li class="chapter" data-level="6" data-path="maintaining-an-open-source-package-in-r.html"><a href="maintaining-an-open-source-package-in-r.html"><i class="fa fa-check"></i><b>6</b> Maintaining an open source package in R</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Brooke Watson: Scraping Javascript websites in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="javascript-webscraping-in-r" class="section level1">
<h1><span class="header-section-number">2</span> Javascript webscraping in R</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="javascript-webscraping-in-r.html#cb2-1"></a><span class="co"># import packages </span></span>
<span id="cb2-2"><a href="javascript-webscraping-in-r.html#cb2-2"></a><span class="kw">library</span>(rvest)</span>
<span id="cb2-3"><a href="javascript-webscraping-in-r.html#cb2-3"></a><span class="kw">library</span>(stringr)</span>
<span id="cb2-4"><a href="javascript-webscraping-in-r.html#cb2-4"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb2-5"><a href="javascript-webscraping-in-r.html#cb2-5"></a><span class="kw">library</span>(purrr)</span>
<span id="cb2-6"><a href="javascript-webscraping-in-r.html#cb2-6"></a><span class="kw">library</span>(here)</span>
<span id="cb2-7"><a href="javascript-webscraping-in-r.html#cb2-7"></a><span class="kw">library</span>(beepr)</span>
<span id="cb2-8"><a href="javascript-webscraping-in-r.html#cb2-8"></a><span class="kw">library</span>(DT)</span></code></pre></div>
<p>Getting the audio files entailed a fair bit of preliminary work. I had to:</p>
<ol style="list-style-type: decimal">
<li>Scrape <a href="http://therapboard.com/">TheRapBoard</a> to find paths to all of the audio files.</li>
<li>Download mp3 files from the website.</li>
<li>Convert them from .mp3 to .wav format.</li>
<li>Pare down from ~300 to ~50 sounds to keep the package (relatively) light.</li>
<li>Put them in a folder that R would recognize and bundle into my package.</li>
</ol>
<p><em>A note</em>: web scraping can be a tremendously useful way to extract data from the internet, but it can cause real problems for some websites and should be done respectfully and ethically. <a href="https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01">This post</a> from James Densmore lays out some guidelines for doing this responsibly. Before I did anything, I checked to see whether The Rap Board had a <a href="http://www.robotstxt.org/robotstxt.html">robots.txt</a> file that prevented or provided specific instructions on how to scrape the site. I recommend doing this before any web scraping project - and keeping that in mind if you’re thinking of reproducing this script.</p>
<div id="download-phantomjs-using-homebrew" class="section level2">
<h2><span class="header-section-number">2.1</span> Download PhantomJS using homebrew</h2>
<p>Httr and rvest are the two R packages that work together to scrape html websites. Usually, this works by using a browser extension called SelectorGadget to find all items styled with a particular CSS - actors in an IMDB table, for example. For more, check out the SelectorGadget vignette:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="javascript-webscraping-in-r.html#cb3-1"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(rvest)) {</span>
<span id="cb3-2"><a href="javascript-webscraping-in-r.html#cb3-2"></a>  <span class="kw">install.packages</span>(<span class="st">&quot;rvest&quot;</span>)</span>
<span id="cb3-3"><a href="javascript-webscraping-in-r.html#cb3-3"></a>  <span class="kw">library</span>(rvest)</span>
<span id="cb3-4"><a href="javascript-webscraping-in-r.html#cb3-4"></a>}</span>
<span id="cb3-5"><a href="javascript-webscraping-in-r.html#cb3-5"></a><span class="kw">vignette</span>(<span class="st">&quot;selectorgadget&quot;</span>)</span></code></pre></div>
<p>Unfortunately, this didn’t work for the website I wanted to scrape, which was written primarily in JavaScript. Instead, I adapted Florian Teschner’s <a href="https://www.r-bloggers.com/web-scraping-javascript-rendered-sites/">instructions</a> on using PhantomJS to convert the website into HTML. I wrapped this in a <code>system()</code> call inside R Studio, but it could just as easily be done from the command line.</p>
<p>Before we can do anything, we need to download and unzip <a href="phantomjs.org">PhantomJS</a>. This can be done from the link, but if you have a Mac and insist on staying inside RStudio, below is some circuitous R code you can use to do just that. It first downloads <a href="https://brew.sh/">Homebrew</a>, if you don’t have it yet, and then downloads <a href="http://phantomjs.org/">PhantomJS</a>. Homebrew is an easy way to install packages onto a Mac from the terminal. PhantomJS calls itself “a headless WebKit scriptable with a JavaScript API”, which for our purposes means that it will convert a JavaScript website like Rap Board into html. This means we can get the paths to the .mp3 soundboard files really easily.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="javascript-webscraping-in-r.html#cb4-1"></a><span class="co"># donwload homebrew if it doesn&#39;t already exist </span></span>
<span id="cb4-2"><a href="javascript-webscraping-in-r.html#cb4-2"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(<span class="st">&quot;/usr/local/Homebrew&quot;</span>)) {</span>
<span id="cb4-3"><a href="javascript-webscraping-in-r.html#cb4-3"></a>  <span class="kw">system</span>(<span class="st">&#39;ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;&#39;</span>)</span>
<span id="cb4-4"><a href="javascript-webscraping-in-r.html#cb4-4"></a>}</span>
<span id="cb4-5"><a href="javascript-webscraping-in-r.html#cb4-5"></a></span>
<span id="cb4-6"><a href="javascript-webscraping-in-r.html#cb4-6"></a><span class="co"># download phantomjs using homebrew </span></span>
<span id="cb4-7"><a href="javascript-webscraping-in-r.html#cb4-7"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(<span class="st">&quot;/usr/local/Cellar/phantomjs&quot;</span>)) {</span>
<span id="cb4-8"><a href="javascript-webscraping-in-r.html#cb4-8"></a>    <span class="kw">system</span>(<span class="st">&quot;brew install phantomjs&quot;</span>) </span>
<span id="cb4-9"><a href="javascript-webscraping-in-r.html#cb4-9"></a>}</span></code></pre></div>
</div>
<div id="writing-scrape.js" class="section level2">
<h2><span class="header-section-number">2.2</span> Writing scrape.js</h2>
<p>Next, we’ll write the JavaScript code to a js file called scrape.js. If you want to scrape a different JavaScript URL, we can change the path in the next function.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="javascript-webscraping-in-r.html#cb5-1"></a><span class="co"># write the javascript code to a new file, scrape.js</span></span>
<span id="cb5-2"><a href="javascript-webscraping-in-r.html#cb5-2"></a></span>
<span id="cb5-3"><a href="javascript-webscraping-in-r.html#cb5-3"></a><span class="kw">writeLines</span>(<span class="st">&quot;var url = &#39;http://therapboard.com&#39;;</span></span>
<span id="cb5-4"><a href="javascript-webscraping-in-r.html#cb5-4"></a><span class="st">var page = new WebPage();</span></span>
<span id="cb5-5"><a href="javascript-webscraping-in-r.html#cb5-5"></a><span class="st">var fs = require(&#39;fs&#39;);</span></span>
<span id="cb5-6"><a href="javascript-webscraping-in-r.html#cb5-6"></a></span>
<span id="cb5-7"><a href="javascript-webscraping-in-r.html#cb5-7"></a><span class="st">page.open(url, function (status) {</span></span>
<span id="cb5-8"><a href="javascript-webscraping-in-r.html#cb5-8"></a><span class="st">        just_wait();</span></span>
<span id="cb5-9"><a href="javascript-webscraping-in-r.html#cb5-9"></a><span class="st">});</span></span>
<span id="cb5-10"><a href="javascript-webscraping-in-r.html#cb5-10"></a></span>
<span id="cb5-11"><a href="javascript-webscraping-in-r.html#cb5-11"></a><span class="st">function just_wait() {</span></span>
<span id="cb5-12"><a href="javascript-webscraping-in-r.html#cb5-12"></a><span class="st">    setTimeout(function() {</span></span>
<span id="cb5-13"><a href="javascript-webscraping-in-r.html#cb5-13"></a><span class="st">               fs.write(&#39;1.html&#39;, page.content, &#39;w&#39;);</span></span>
<span id="cb5-14"><a href="javascript-webscraping-in-r.html#cb5-14"></a><span class="st">            phantom.exit();</span></span>
<span id="cb5-15"><a href="javascript-webscraping-in-r.html#cb5-15"></a><span class="st">    }, 2500);</span></span>
<span id="cb5-16"><a href="javascript-webscraping-in-r.html#cb5-16"></a><span class="st">}</span></span>
<span id="cb5-17"><a href="javascript-webscraping-in-r.html#cb5-17"></a><span class="st">&quot;</span>, <span class="dt">con =</span> <span class="st">&quot;scrape.js&quot;</span>)</span></code></pre></div>
</div>
<div id="scraping-therapboard.com" class="section level2">
<h2><span class="header-section-number">2.3</span> Scraping TheRapBoard.com</h2>
<p>This function takes <code>scrape.js</code> and the url of our choice (in this case, the url that hosts the audio files we need) and calls PhantomJS from the command line on a Mac. If you didn’t download PhantomJS using homebrew, you’ll need to include the path to your downloaded PhantomJS package as a <code>phantompath</code> argument. If you use Windows, this also is going to look different.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="javascript-webscraping-in-r.html#cb6-1"></a>js_scrape &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">url =</span> <span class="st">&quot;http://therapboard.com&quot;</span>, </span>
<span id="cb6-2"><a href="javascript-webscraping-in-r.html#cb6-2"></a>                      <span class="dt">js_path =</span> <span class="st">&quot;scrape.js&quot;</span>, </span>
<span id="cb6-3"><a href="javascript-webscraping-in-r.html#cb6-3"></a>                      <span class="dt">phantompath =</span> <span class="st">&quot;/usr/local/Cellar/phantomjs/2.1.1/bin/phantomjs&quot;</span>){</span>
<span id="cb6-4"><a href="javascript-webscraping-in-r.html#cb6-4"></a>  </span>
<span id="cb6-5"><a href="javascript-webscraping-in-r.html#cb6-5"></a>  <span class="co"># this section will replace the url in scrape.js to whatever you want </span></span>
<span id="cb6-6"><a href="javascript-webscraping-in-r.html#cb6-6"></a>  lines &lt;-<span class="st"> </span><span class="kw">readLines</span>(js_path)</span>
<span id="cb6-7"><a href="javascript-webscraping-in-r.html#cb6-7"></a>  lines[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;var url =&#39;&quot;</span>, url ,<span class="st">&quot;&#39;;&quot;</span>)</span>
<span id="cb6-8"><a href="javascript-webscraping-in-r.html#cb6-8"></a>  <span class="kw">writeLines</span>(lines, js_path)</span>
<span id="cb6-9"><a href="javascript-webscraping-in-r.html#cb6-9"></a>  </span>
<span id="cb6-10"><a href="javascript-webscraping-in-r.html#cb6-10"></a>  command =<span class="st"> </span><span class="kw">paste</span>(phantompath, js_path, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb6-11"><a href="javascript-webscraping-in-r.html#cb6-11"></a>  <span class="kw">system</span>(command)</span>
<span id="cb6-12"><a href="javascript-webscraping-in-r.html#cb6-12"></a></span>
<span id="cb6-13"><a href="javascript-webscraping-in-r.html#cb6-13"></a>}</span>
<span id="cb6-14"><a href="javascript-webscraping-in-r.html#cb6-14"></a></span>
<span id="cb6-15"><a href="javascript-webscraping-in-r.html#cb6-15"></a><span class="kw">js_scrape</span>()</span></code></pre></div>
</div>
<div id="extracting-audio-files" class="section level2">
<h2><span class="header-section-number">2.4</span> Extracting audio files</h2>
<p>After converting the rap board’s website from Javascript into html, I could use <code>rvest</code> and <code>dplyr</code> package functions to get the mp3 paths into a format that I wanted. The code below required some fiddling with stringr and regex to convert a jumble of html into a list of file paths. It could be more succinct, but it works.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="javascript-webscraping-in-r.html#cb7-1"></a><span class="co"># read the newly created html file </span></span>
<span id="cb7-2"><a href="javascript-webscraping-in-r.html#cb7-2"></a>html &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;1.html&quot;</span>)</span>
<span id="cb7-3"><a href="javascript-webscraping-in-r.html#cb7-3"></a></span>
<span id="cb7-4"><a href="javascript-webscraping-in-r.html#cb7-4"></a>setup &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-5"><a href="javascript-webscraping-in-r.html#cb7-5"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;source&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-6"><a href="javascript-webscraping-in-r.html#cb7-6"></a><span class="st">  </span><span class="kw">str_c</span>(<span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-7"><a href="javascript-webscraping-in-r.html#cb7-7"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-8"><a href="javascript-webscraping-in-r.html#cb7-8"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">str_detect</span>(value, <span class="st">&#39;ogg&quot;&#39;</span>)) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb7-9"><a href="javascript-webscraping-in-r.html#cb7-9"></a><span class="st">  </span><span class="kw">lapply</span>(., str_replace, <span class="st">&#39;&lt;source src=</span><span class="ch">\&quot;</span><span class="st">&#39;</span>, <span class="st">&quot;http://therapboard.com/&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-10"><a href="javascript-webscraping-in-r.html#cb7-10"></a><span class="st">  </span><span class="kw">lapply</span>(., str_split, <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st"> type&quot;</span>)</span>
<span id="cb7-11"><a href="javascript-webscraping-in-r.html#cb7-11"></a></span>
<span id="cb7-12"><a href="javascript-webscraping-in-r.html#cb7-12"></a>mp3s =<span class="st"> </span><span class="kw">map</span>(<span class="kw">seq_along</span>(setup<span class="op">$</span>value), <span class="op">~</span>setup<span class="op">$</span>value[[.x]][<span class="dv">1</span>]) </span></code></pre></div>
</div>
<div id="downloading-mp3s" class="section level2">
<h2><span class="header-section-number">2.5</span> Downloading mp3s</h2>
<p>Finally, I had the list of mp3 paths. I wrote a function to download the urls into an <code>mp3s/</code> folder that I created inside the function. I used <code>Sys.sleep()</code> to introduce a random lag in between each download, which I hear is <a href="https://gist.github.com/abelsonlive/3769469">best practice</a>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="javascript-webscraping-in-r.html#cb8-1"></a>download_mp3s =<span class="st"> </span><span class="cf">function</span>(url) { </span>
<span id="cb8-2"><a href="javascript-webscraping-in-r.html#cb8-2"></a>  <span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(<span class="st">&quot;mp3s&quot;</span>)) {<span class="kw">dir.create</span>(<span class="st">&quot;mp3s&quot;</span>)}</span>
<span id="cb8-3"><a href="javascript-webscraping-in-r.html#cb8-3"></a>  <span class="co"># create a place to put them if you haven&#39;t yet </span></span>
<span id="cb8-4"><a href="javascript-webscraping-in-r.html#cb8-4"></a>  </span>
<span id="cb8-5"><a href="javascript-webscraping-in-r.html#cb8-5"></a>  url =<span class="st"> </span>url</span>
<span id="cb8-6"><a href="javascript-webscraping-in-r.html#cb8-6"></a>  destpath =<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_replace</span>(url, <span class="st">&quot;http://therapboard.com/audio/&quot;</span>, <span class="st">&quot;mp3s/&quot;</span>)</span>
<span id="cb8-7"><a href="javascript-webscraping-in-r.html#cb8-7"></a>  <span class="kw">download.file</span>(url, <span class="dt">destfile =</span> destpath)</span>
<span id="cb8-8"><a href="javascript-webscraping-in-r.html#cb8-8"></a>  <span class="kw">Sys.sleep</span>(<span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dt">by=</span><span class="fl">0.001</span>), <span class="dv">1</span>))</span>
<span id="cb8-9"><a href="javascript-webscraping-in-r.html#cb8-9"></a>} </span></code></pre></div>
<p>Then, I waited. Fittingly, I used beepr to alert me when my script was done.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="javascript-webscraping-in-r.html#cb9-1"></a><span class="kw">lapply</span>(mp3s, download_mp3s)</span>
<span id="cb9-2"><a href="javascript-webscraping-in-r.html#cb9-2"></a><span class="kw">beep</span>(<span class="st">&quot;mario&quot;</span>)</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="background-remixing-packages-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="organizing-an-r-package.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
